<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gold Price Converter</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-md mx-auto bg-white rounded-2xl shadow-xl p-6 space-y-4">
    <h1 class="text-2xl font-bold text-center">金价换算器</h1>

    <div>
      <label id="label-input" class="block mb-1 font-medium">国际金价 (美元/盎司)</label>
      <input
        type="number"
        id="input-price"
        class="w-full border rounded px-3 py-2"
        value="3500"
        step="1"
      />
    </div>

    <div>
      <label class="block mb-1 font-medium">汇率 (USD to CNY)</label>
      <input
        type="number"
        id="input-rate"
        class="w-full border rounded px-3 py-2"
        value="7.2"
        step="0.0001"
      />
    </div>

    <div>
      <label class="block mb-1 font-medium flex items-center">
        基差调整 (元/克)
        <span class="ml-1 relative group cursor-pointer select-none" aria-label="提示">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
            <text x="12" y="16" text-anchor="middle" font-size="12" fill="currentColor" font-family="Arial, sans-serif" font-weight="bold">?</text>
          </svg>
          <span
            class="absolute hidden group-hover:block w-64 text-sm bg-gray-700 text-white rounded p-2 mt-1 z-10"
          >
            沪金价与国际金价之间的差值，通常为 +0 到 +20 元/克，可根据市场情况微调。
          </span>
        </span>
      </label>
      <input
        type="number"
        id="input-basis"
        class="w-full border rounded px-3 py-2"
        value="0"
        step="0.01"
      />
    </div>

    <div class="flex justify-between items-center flex-wrap gap-2">
      <label class="flex items-center space-x-2">
        <input type="checkbox" id="reverse-switch" />
        <span>反向计算 (沪金价 → 国际金价)</span>
      </label>
      <label class="flex items-center space-x-2">
        <input type="checkbox" id="manual-calc-switch" />
        <span>手动计算</span>
      </label>
      <button
        id="btn-calc"
        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
      >
        计算
      </button>
    </div>

    <div
      id="output"
      class="mt-4 bg-gray-50 p-4 rounded text-center text-lg font-semibold"
    >
    </div>
  </div>

  <script>
    const ozToGram = 31.1035;

    function calculate() {
      const reverse = document.getElementById("reverse-switch").checked;
      const inputPrice = parseFloat(
        document.getElementById("input-price").value
      );
      const rate = parseFloat(document.getElementById("input-rate").value);
      const basis = parseFloat(document.getElementById("input-basis").value);
      const output = document.getElementById("output");

      if (isNaN(inputPrice) || isNaN(rate) || isNaN(basis)) {
        output.innerText = "请输入有效的数值。";
        return;
      }

      let result;
      if (!reverse) {
        result = (inputPrice * rate) / ozToGram + basis;
        output.innerHTML = `沪金价约为 <strong>${result.toFixed(2)}</strong> 元/克`;
      } else {
        result = ((inputPrice - basis) * ozToGram) / rate;
        output.innerHTML = `国际金价约为 <strong>${result.toFixed(2)}</strong> 美元/盎司`;
      }
    }

    // 反向切换时交换输入和输出的数值，不自动计算
    document.getElementById("reverse-switch").addEventListener("change", function () {
      const label = document.getElementById("label-input");
      const input = document.getElementById("input-price");
      const output = document.getElementById("output");

      // 提取输出中的数字
      const resultMatch = output.innerText.match(/[\d.]+/);
      if (resultMatch) {
        const val = parseFloat(resultMatch[0]);
        if (!isNaN(val)) {
          const oldOutput = output.innerHTML;
          const oldInput = input.value;

          input.value = val;
          output.innerHTML = oldOutput.replace(/[\d.]+/, oldInput);
        }
      }

      if (this.checked) {
        label.innerText = "沪金价 (元/克)";
        input.placeholder = "请输入沪金价";
      } else {
        label.innerText = "国际金价 (美元/盎司)";
        input.placeholder = "请输入国际金价";
      }
    });

    // 自动计算控制函数
    function tryAutoCalculate() {
      const manual = document.getElementById("manual-calc-switch").checked;
      if (!manual) calculate();
    }

    // 绑定输入事件自动计算（受手动开关控制）
    ["input-price", "input-rate", "input-basis"].forEach(id => {
      document.getElementById(id).addEventListener("input", tryAutoCalculate);
    });

    // 计算按钮
    document.getElementById("btn-calc").addEventListener("click", calculate);

    // 页面初始化
    window.onload = () => {
      calculate();
    };
  </script>
</body>
</html>
